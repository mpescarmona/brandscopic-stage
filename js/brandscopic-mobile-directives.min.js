angular.module("brandscopicApp.sharedDirectives",[]).directive("scopicTypeahead",["$q","CompanyService","debounce","UserService","Venue","Event","eventService","venueService",function($q,CompanyService,debounce,UserService,Venue,Event,eventService,venueService){"use strict";var link=function(scope,element,attrs){function removeTagOnSelect(str){return String(str).replace("<i>","").replace("</i>","")}$.widget("custom.catcomplete",$.ui.autocomplete,{_renderMenu:function(ul,items){var that=this,currentCategory="";$.each(items,function(index,item){item.category&&item.category!=currentCategory&&(ul.append("<li class='ui-autocomplete-category'><span class='category'><strong>"+item.category+"</strong></span></li>"),currentCategory=item.category),that._renderItemData(ul,item)})}}),$("#searchEvent").catcomplete({delay:0,source:function(request,response){"events"==attrs.source&&eventService.getEventSearch(request.term).then(function(data){response(data)}),"venues"==attrs.source&&venueService.getVenuesAutocomplete(request.term).then(function(data){response(data)})},focus:function(event,ui){return void 0==ui.item?!1:void(ui.item.value=removeTagOnSelect("events"==attrs.source?ui.item.value:ui.item.label))},select:function(event,ui){return null!=ui.item&&void 0!=ui.item&&(scope.$broadcast("RESULT_SEARCH",{id:ui.item.id,type:ui.item.type}),scope.searchEvent=ui.item.value),!1}}).data("custom-catcomplete")._renderItem=function(ul,item){return $("<li></li>").data("ui-autocomplete-item",item).append("<a>"+item.label+"</a>").appendTo(ul)}};return{link:link,restrict:"E",templateUrl:"views/directives/templates/typeahead.html"}}]).directive("scopicAutoExpand",function(){return{restrict:"A",link:function($scope,elem){var textSummary,wordsCount;$scope.$watch("event.summary",function(value){null!=value&&(textSummary=value.split(" "),wordsCount=textSummary.length),$scope.showMoreTextLink=wordsCount>100?!0:!1}),$scope.$watch("isActive",function(value){if(value&&$scope.isMore){var height=elem[0].scrollHeight;elem.height(height),elem.bind("keyup",function($event){$event.target;elem.height(0);var height=elem[0].scrollHeight;elem.height(height)})}else elem.unbind("keyup"),elem.height(50)})}}}),angular.module("brandscopicApp.eventDirectives",[]).directive("scopicEventFilter",["$q","CompanyService","debounce","UserService","Venue","Event","eventService","UserInterface","$window","$state",function($q,CompanyService,debounce,UserService,Venue,Event,eventService,UserInterface,$window,$state){"use strict";var link=function(scope){scope.getEventBorderColor=function(event_status){var classSelected;switch(event_status){case scopic.consts.event_status.APPROVED:classSelected="approve";break;case scopic.consts.event_status.LATE:classSelected="late";break;case scopic.consts.event_status.DUE:classSelected="due";break;case scopic.consts.event_status.SUBMITTED:classSelected="submitted";break;case scopic.consts.event_status.REJECTED:classSelected="late"}return classSelected},scope.getEventBorderColor=function(event_status){var classSelected;switch(event_status){case scopic.consts.event_status.APPROVED:classSelected="approve";break;case scopic.consts.event_status.LATE:classSelected="late";break;case scopic.consts.event_status.DUE:classSelected="due";break;case scopic.consts.event_status.SUBMITTED:classSelected="submitted";break;case scopic.consts.event_status.REJECTED:classSelected="late"}return classSelected},scope.getLastOfDateButtonClass=function(event){return event.start_date_LAST_OF_GROUP?"last_of_group":""},scope.handleEventClick=function(permission,state,eventId){UserService.permissionIsValid(permission)&&$state.go(state,{eventId:eventId})},scope.permissionIsValid=function(permission){return UserService.permissionIsValid(permission)},scope.$watch("filter",function(value){console.log(value);var campaign=[],place=[],user=[],brand=[],brand_portfolio=[],venue=[];if(""!==value||void 0!==value){switch(value.type){case scopic.consts.events_typeahead_categories.CAMPAIGN:campaign.push(value.id);break;case scopic.consts.events_typeahead_categories.BRAND:brand.push(value.id);break;case scopic.consts.events_typeahead_categories.BRAND2:brand_portfolio.push(value.id);break;case scopic.consts.events_typeahead_categories.PLACE:place.push(value.id);break;case scopic.consts.events_typeahead_categories.USER:user.push(value.id);break;case scopic.consts.events_typeahead_categories.VENUE:venue.push(value.id)}eventService.getEventsByFilters(campaign,place,user,brand,brand_portfolio,venue).then(function(response){scope.eventsItems=response.results})}})};return{link:link,scope:{filter:"=",eventsItems:"="},restrict:"E",templateUrl:"views/directives/templates/eventFilter.html"}}]),angular.module("highcharts-ng",[]).directive("highchart",function(){function prependMethod(obj,method,func){var original=obj[method];obj[method]=function(){var args=Array.prototype.slice.call(arguments);return func.apply(this,args),original?original.apply(this,args):void 0}}function deepExtend(destination,source){for(var property in source)source[property]&&source[property].constructor&&source[property].constructor===Object?(destination[property]=destination[property]||{},deepExtend(destination[property],source[property])):destination[property]=source[property];return destination}var indexOf=function(arr,find,i){void 0===i&&(i=0),0>i&&(i+=arr.length),0>i&&(i=0);for(var n=arr.length;n>i;i++)if(i in arr&&arr[i]===find)return i;return-1},seriesId=0,ensureIds=function(series){angular.forEach(series,function(s){angular.isDefined(s.id)||(s.id="series-"+seriesId++)})},axisNames=["xAxis","yAxis"],getMergedOptions=function(scope,element,config){var mergedOptions={},defaultOptions={chart:{events:{}},title:{},subtitle:{},series:[],credits:{},plotOptions:{},navigator:{enabled:!1}};return mergedOptions=config.options?deepExtend(defaultOptions,config.options):defaultOptions,mergedOptions.chart.renderTo=element[0],angular.forEach(axisNames,function(axisName){config[axisName]&&(prependMethod(mergedOptions.chart.events,"selection",function(e){var thisChart=this;scope.$apply(e[axisName]?function(){scope.config[axisName].currentMin=e[axisName][0].min,scope.config[axisName].currentMax=e[axisName][0].max}:function(){scope.config[axisName].currentMin=thisChart[axisName][0].dataMin,scope.config[axisName].currentMax=thisChart[axisName][0].dataMax})}),prependMethod(mergedOptions.chart.events,"addSeries",function(){scope.config[axisName].currentMin=this[axisName][0].min||scope.config[axisName].currentMin,scope.config[axisName].currentMax=this[axisName][0].max||scope.config[axisName].currentMax}),mergedOptions[axisName]=angular.copy(config[axisName]))}),config.title&&(mergedOptions.title=config.title),config.subtitle&&(mergedOptions.subtitle=config.subtitle),config.credits&&(mergedOptions.credits=config.credits),mergedOptions},updateZoom=function(axis,modelAxis){var extremes=axis.getExtremes();(modelAxis.currentMin!==extremes.dataMin||modelAxis.currentMax!==extremes.dataMax)&&axis.setExtremes(modelAxis.currentMin,modelAxis.currentMax,!1)},processExtremes=function(chart,axis,axisName){(axis.currentMin||axis.currentMax)&&chart[axisName][0].setExtremes(axis.currentMin,axis.currentMax,!0)},chartOptionsWithoutEasyOptions=function(options){return angular.extend({},options,{data:null,visible:null})},prevOptions={},processSeries=function(chart,series){var ids=[];series&&(ensureIds(series),angular.forEach(series,function(s){ids.push(s.id);var chartSeries=chart.get(s.id);chartSeries?angular.equals(prevOptions[s.id],chartOptionsWithoutEasyOptions(s))?(void 0!==s.visible&&chartSeries.visible!==s.visible&&chartSeries.setVisible(s.visible,!1),chartSeries.options.data!==s.data&&chartSeries.setData(angular.copy(s.data),!1)):chartSeries.update(angular.copy(s),!1):chart.addSeries(angular.copy(s),!1),prevOptions[s.id]=chartOptionsWithoutEasyOptions(s)}));for(var i=chart.series.length-1;i>=0;i--){var s=chart.series[i];indexOf(ids,s.options.id)<0&&s.remove(!1)}},initialiseChart=function(scope,element,config){config=config||{};for(var mergedOptions=getMergedOptions(scope,element,config),chart=config.useHighStocks?new Highcharts.StockChart(mergedOptions):new Highcharts.Chart(mergedOptions),i=0;i<axisNames.length;i++)config[axisNames[i]]&&processExtremes(chart,config[axisNames[i]],axisNames[i]);return processSeries(chart,config.series),config.loading&&chart.showLoading(),chart.redraw(),chart};return{restrict:"EAC",replace:!0,template:"<div></div>",scope:{config:"="},link:function(scope,element){function initChart(){chart&&chart.destroy(),chart=initialiseChart(scope,element,scope.config)}var chart=!1;initChart(),scope.$watch("config.series",function(newSeries,oldSeries){newSeries!==oldSeries&&(processSeries(chart,newSeries),chart.redraw())},!0),scope.$watch("config.title",function(newTitle){chart.setTitle(newTitle,!0)},!0),scope.$watch("config.subtitle",function(newSubtitle){chart.setTitle(!0,newSubtitle)},!0),scope.$watch("config.loading",function(loading){loading?chart.showLoading():chart.hideLoading()}),scope.$watch("config.credits.enabled",function(enabled){enabled?chart.credits.show():chart.credits&&chart.credits.hide()}),scope.$watch("config.useHighStocks",function(){initChart()}),angular.forEach(axisNames,function(axisName){scope.$watch("config."+axisName,function(newAxes,oldAxes){newAxes!==oldAxes&&newAxes&&(chart[axisName][0].update(newAxes,!1),updateZoom(chart[axisName][0],angular.copy(newAxes)),chart.redraw())},!0)}),scope.$watch("config.options",function(newOptions,oldOptions){newOptions!==oldOptions&&initChart()},!0),scope.$on("$destroy",function(){chart&&chart.destroy(),element.remove()})}}});